<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NimPlayer GUI</title>
  <script>

    document.addEventListener('DOMContentLoaded', ()=>{
      var game_started = false
      var max_num_at_i = []
      const minus1 = document.getElementById("minus1")
      const minus2 = document.getElementById("minus2")
      const minus3 = document.getElementById("minus3")
      const minus4 = document.getElementById("minus4")

      const minus = [minus1,minus2,minus3,minus4]

      const plus1 = document.getElementById("plus1")
      const plus2 = document.getElementById("plus2")
      const plus3 = document.getElementById("plus3")
      const plus4 = document.getElementById("plus4")

      const plus = [plus1,plus2,plus3,plus4]

      const stack1 = document.getElementById("stack1")
      const stack2 = document.getElementById("stack2")
      const stack3 = document.getElementById("stack3")
      const stack4 = document.getElementById("stack4")

      const stack = [stack1,stack2,stack3,stack4]

      const reset_btn = document.getElementById("reset-btn")
      const play_btn = document.getElementById("play-btn")

      const game_started_h2 = document.getElementById("game-started-h2")



      reset_btn.addEventListener('click',()=>{
          game_started = false
          for(let i = 0; i < 4; ++i){
            plus[i].hidden = false
            minus[i].style.visibility = 'visible'
          }
          stack1.innerHTML = 1
          stack2.innerHTML = 3
          stack3.innerHTML = 5
          stack4.innerHTML = 7
          game_started_h2.innerHTML = "Game not started - Select start state then click play"
      }
      )
      play_btn.addEventListener('click',()=>{
        // Define the URL with the 'board' parameter
        if(!game_started){
          game_started = true
          game_started_h2.innerHTML = "Game Started, click play to enter move"
          max_num_at_i = []
        }
        for(let i = 0; i < 4; ++i){
          plus[i].hidden = true
          minus[i].style.visibility = "visible"
        }

        max_num_at_i = []
        for(let i = 0; i < 4; ++i){
          max_num_at_i[i] = Number(stack[i].innerHTML)
        }

        const boardValue = []; 
        for(let i = 0; i < 4; ++i){
          boardValue.push(Number(stack[i].innerHTML))
        }
        const url = `/play?board=${boardValue}`;
        // Make the GET request
        fetch(url)
          .then((response) => {
            if (!response.ok) {
              alert("Failed to reach server")

              throw new Error(`HTTP error! Status: ${response.status}`);
            }

            return response.json(); // You can use .text() or other methods depending on the response type
          })
          .then((data) => {
            // Handle the response data here
            stack1.innerHTML = data[0]
            stack2.innerHTML = data[1]
            stack3.innerHTML = data[2]
            stack4.innerHTML = data[3]

            
          })
          .catch((error) => {
            // Handle any errors that occurred during the fetch
            console.error('Fetch error:', error);
          });

      }
      )

      for(let i =0; i < 4; ++i){
        minus[i].addEventListener('click', ()=>{
          let tmp = Number(stack[i].innerHTML)-1
          if(tmp >= 0){
            stack[i].innerHTML = tmp
            plus[i].hidden = false
            for(let j = 0; j < 4; ++j){
              if(j != i && game_started){
                minus[j].style.visibility = "hidden"
              }
            }
          }
          
          
        })
        plus[i].addEventListener('click',()=>{
          let tmp = Number(stack[i].innerHTML)+1
          if(tmp<=max_num_at_i[i] || !game_started){
            stack[i].innerHTML = tmp
            if(tmp == max_num_at_i[i]){
              for(let j = 0; j < 4; ++j){
                minus[j].style.visibility = "visible"
                plus[j].hidden = true
              }
            }
     
          }

        })
      }
    })



  </script>
</head>
<body>
  <h1>Nim Player GUI v0.1</h1>
  <h2 id="game-started-h2">Game not started - Select start state then click play</h2>
  <button id="minus1" class="plus-minus-btn">-</button><p id="stack1" style="display: inline;">1</p><button id="plus1" class="plus-minus-btn">+</button><br>
  <button id="minus2" class="plus-minus-btn">-</button><p id="stack2" style="display: inline;">3</p><button id="plus2" class="plus-minus-btn">+</button><br>
  <button id="minus3" class="plus-minus-btn">-</button><p id="stack3" style="display: inline;">5</p><button id="plus3" class="plus-minus-btn">+</button><br>
  <button id="minus4" class="plus-minus-btn">-</button><p id="stack4" style="display: inline;">7</p><button id="plus4" class="plus-minus-btn">+</button><br>

  <button id="play-btn">Play Move</button><br>
  <button id="reset-btn">New Game</button>
</body>
</html>